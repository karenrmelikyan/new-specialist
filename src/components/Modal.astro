---
interface Props {
    open?: boolean;
    title: string;
    subTitle: string;
    inputName: string;
    inputPhone: string;
    inputCode: string;
    captchaText: string;
    captchaAgreeText: string;
    captchaAgreeHrefText: string,
    captchaAgreeHref: string,
    btnText: string;
}

declare global {
    interface Window {
        openModal: () => void
    }
}

const { 
    open = false,
    title = '',
    subTitle = '',
    inputName = '',
    inputPhone = '',
    inputCode = '',
    captchaText = '',
    captchaAgreeText = '',
    captchaAgreeHrefText = '',
    captchaAgreeHref = '',
    btnText = '',
} = Astro.props
---
<style>
    /* =========================
    Overlay
    ========================= */
    .modal-overlay {
        position: fixed;
        inset: 0;
        z-index: 1000;

        display: flex;
        align-items: center;
        justify-content: center;

        background: rgba(0, 0, 0, 0.55);

        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }

    .modal-overlay.is-open {
        opacity: 1;
        pointer-events: all;
    }

    /* =========================
    Modal
    ========================= */
    .modal {
        position: relative;

        width: min(92vw, calc(var(--main-container-width) / 1.35));
        height: 100%;

        padding: 48px;
        border-radius: var(--border-radius-huge);

        background: var(--main-font-color);
        color: var(--main-background-color);

        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);
    }

    /* =========================
    Close button
    ========================= */
    .modal-close {
        position: absolute;
        top: 16px;
        right: 16px;

        width: 64px;
        height: 64px;
        border-radius: 50%;

        display: flex;
        align-items: center;
        justify-content: center;

        border: none;
        background: rgba(255, 255, 255, 0.18);

        color: var(--main-background-color);
        font-size: var(--large);

        cursor: pointer;
        transition: background 0.6s ease, transform 0.6s ease;
    }

    .modal-close:hover {
        background: rgba(255, 255, 255, 0.38);
    }

    /* =========================
    Text
    ========================= */
    .modal-title,
    .modal-subtitle {
        font-weight: var(--font-weight);
    }

    .modal-title {
        margin-bottom: 12px;
        font-size: var(--large);
    }

    .modal-subtitle {
        margin-bottom: var(--large);
        font-size: var(--middle);
        opacity: 0.9;
    }

    /* =========================
    Form
    ========================= */
    .modal-form {
        display: flex;
        flex-direction: column;
        gap: var(--small);
    }

    .modal-form input {
        padding: var(--padding-large);
        border-radius: 22px;
        border: 2px solid transparent;

        background: rgba(255, 255, 255, 0.087);

        font-size: var(--small);
        color: var(--main-background-color);

        outline: none;
        transition: border-color 0.6s ease;
    }

    .modal-form input:hover {
        border-color: var(--main-background-color);
    }

    .modal-form input::placeholder {
        color: var(--main-background-color);
    }

    /* =========================
    Captcha
    ========================= */
    .captcha-row {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .captcha-image,
    .captcha-refresh {
        color: var(--main-background-color);
    }

    .captcha-image {
        padding: 10px 16px;
        border-radius: 6px;

        background: var(--main-background-color);
        color: #333;

        font-weight: var(--font-weight);
        letter-spacing: 4px;
    }

    .captcha-refresh {
        border: none;
        background: none;

        font-size: 20px;
        cursor: pointer;
    }

    /* =========================
    Checkbox
    ========================= */
    .checkbox {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin-top: 10px;

        font-size: var(--small);
    }

    .checkbox input {
        margin-top: 4px;
        transform: scale(1.6);
        accent-color: var(--main-background-color);
    }

    .checkbox a {
        color: var(--main-background-color);
        text-decoration: underline;
    }

    /* =========================
    Submit
    ========================= */
    .submit-btn {
        margin-top: 10px;
        padding: var(--padding-large);

        border: none;
        border-radius: var(--border-radius-small);

        background: #f44336;
        color: var(--main-background-color);

        font-size: 24px;
        font-weight: var(--font-weight);

        cursor: pointer;
        transition: transform 0.6s ease, box-shadow 0.6s ease;
    }

    .submit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 25px rgba(244, 67, 54, 0.4);
    }
</style>

<div class={`modal-overlay ${open ? "is-open" : ""}`} id="modal">
    <div class="modal">
        <button class="modal-close" aria-label="Close modal">&times;</button>

        <h2 class="modal-title">{title}</h2>
        <p class="modal-subtitle">{subTitle}</p>

        <form class="modal-form">
            <input type="text" placeholder={inputName} />

            <input type="tel" placeholder={inputPhone} required />

            {captchaText}
            <div class="captcha-row">
                <div class="captcha-image">
                    Г Н Е Т
                </div>
                <button type="button" class="captcha-refresh" aria-label="Refresh captcha">
                  ↻
                </button>
            </div>

            <input type="text" placeholder={inputCode} required />

            <label class="checkbox">
                <input type="checkbox" checked />
                <span>
                    {captchaAgreeText}
                    <a href={captchaAgreeHref} target="_blank">{captchaAgreeHrefText}</a>
                </span>
            </label>

            <button type="submit" class="submit-btn">{btnText}</button>
        </form>
    </div>
</div>

<script>
    const modal = document.getElementById("modal") as HTMLElement
    const closeBtn = modal.querySelector(".modal-close") as HTMLElement

    closeBtn.addEventListener("click", () => {
        modal.classList.remove("is-open")
    })

    modal.addEventListener("click", (e) => {
        if (e.target === modal) {
            modal.classList.remove("is-open")
        }
    })

    // optional global open function
    window.openModal = () => modal.classList.add("is-open")
</script>

