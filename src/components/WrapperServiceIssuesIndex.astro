---
import Main from '../layouts/ru/Main.astro'
import HeroBanner from './HeroBanner.astro'
import ContentIssues from './ContentIssues.astro'
import ENV from '../content/ru/env.json'
import getProductSEO from '../../public/js/build/getProductSEO.mjs'
import getProductJsonLd from '../../public/js/build/getProductJsonLd.mjs'
import getGlobalDataByURI from '../../public/js/build/getGlobalDataByURI.mjs'

interface ServiceItem {
    slug: string
    title: string
    sign: string
    slugs?: string[]
}

interface ServiceContent {
    indexPageTitle: string
    title: string
    subTitle: string
    subSign: string
    subCauses: string
    btnText: string
    items: ServiceItem[]
}

interface Props {
    content: ServiceContent
}

const { content } = Astro.props as Props

// Logic for Index: Filter items that have children (sub-categories)
const rootItems = content.items.filter(i => i.slugs && i.slugs.length > 0)

const pageData = {
    title: content.title,
    subTitle: content.subTitle,
    subSign: content.subSign,
    subCauses: content.subCauses,
    btnText: content.btnText,
    items: rootItems
}

const src = getGlobalDataByURI(Astro.url.pathname).src
const price = getGlobalDataByURI(Astro.url.pathname).price

const { title, description } = getProductSEO(content.indexPageTitle, content.subTitle, 'ru')
const productJsonLd = getProductJsonLd(
    content.indexPageTitle, 
    description, 
    src,
    price,
    ENV
)
---

<Main title={title} description={description} jsonLd={productJsonLd}>
    <HeroBanner 
        h1={content.indexPageTitle}
        src={src}
        price={price + ' ' + ENV.CURRENCY_SIGN}
    />
    <div class="offset"></div>
    <div class="offset"></div>
    <div class="offset"></div>
    <ContentIssues issues={pageData} />
</Main>